{"version":3,"sources":["skylark-domx-carets.js"],"names":["define","skylark","langx","noder","datax","_rCarriageReturn","_normalizePos","input","pos","norm","val","replace","len","length","Math","floor","Range","start","end","text","this","getCaret","selectionStart","setCaret","focus","setSelectionRange","insertAtCaret","curPos","_getCaret","oldValueNorm","newLength","maxLength","getAttribute","_hasAttr","delta","substr","getInputRange","range","selectionEnd","min","max","substring","setInputRange","startPos","endPos","replaceInputRange","oldValue","selection","attr","startText","endText","carets","prototype","toString","JSON","stringify","mixin","selectAll","elem","select","window","getSelection","document","createRange","selectNodeContents","removeAllRanges","addRange","deselectAll","empty","caret","arg1","undefined","arg2","attach","velm","$","delegate","fn","wraps","wrapper_value","main"],"mappings":"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","file":"../skylark-domx-carets.js","sourcesContent":["define('skylark-domx-carets/carets',[\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-data\"\r\n], function(skylark, langx, noder, datax) {\r\n    \"use strict\";\r\n\r\n    var  _rCarriageReturn = /\\r/g;\r\n\r\n    function _normalizePos(input, pos) {\r\n        var norm = datax.val(input).replace(_rCarriageReturn, '');\r\n        var len = norm.length;\r\n\r\n        if (typeof(pos) === 'undefined') {\r\n            pos = len;\r\n        }\r\n\r\n        pos = Math.floor(pos);\r\n\r\n        // Negative index counts backward from the end of the input/textarea's value\r\n        if (pos < 0) {\r\n            pos = len + pos;\r\n        }\r\n\r\n        // Enforce boundaries\r\n        if (pos < 0) { pos = 0; }\r\n        if (pos > len) { pos = len; }\r\n\r\n        return pos;\r\n    };\r\n\r\n    /**\r\n     * @class\r\n     * @constructor\r\n     */\r\n    var Range = function(start, end, length, text) {\r\n        this.start = start || 0;\r\n        this.end = end || 0;\r\n        this.length = length || 0;\r\n        this.text = text || '';\r\n    };\r\n\r\n    Range.prototype.toString = function() {\r\n        return JSON.stringify(this, null, '    ');\r\n    };\r\n\r\n\r\n    /**\r\n     * Gets the position of the caret in the given input.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @returns {Number}\r\n     * @see http://stackoverflow.com/questions/263743/how-to-get-cursor-position-in-textarea/263796#263796\r\n     */\r\n    function getCaret(input) {\r\n        if (!input) {\r\n            return undefined;\r\n        }\r\n\r\n        return input.selectionStart;\r\n\r\n    };\r\n\r\n    /**\r\n     * Sets the position of the caret in the given input.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @param {Number} pos\r\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\r\n     */\r\n     function setCaret(input, pos) {\r\n        input.focus();\r\n\r\n        pos = _normalizePos(input, pos);\r\n\r\n        input.setSelectionRange(pos, pos);\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Inserts the specified text at the current caret position in the given input.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @param {String} text\r\n     */\r\n    function insertAtCaret(input, text) {\r\n        var curPos = _getCaret(input);\r\n\r\n        var oldValueNorm = datax.val(input).replace(_rCarriageReturn, '');\r\n\r\n        var newLength = +(curPos + text.length + (oldValueNorm.length - curPos));\r\n        var maxLength = +input.getAttribute('maxlength');\r\n\r\n        if(_hasAttr(input, 'maxlength') && newLength > maxLength) {\r\n            var delta = text.length - (newLength - maxLength);\r\n            text = text.substr(0, delta);\r\n        }\r\n\r\n        datax.val(input, oldValueNorm.substr(0, curPos) + text + oldValueNorm.substr(curPos));\r\n\r\n        setCaret(input, curPos + text.length);\r\n\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Gets the selected text range of the given input.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @returns {Range}\r\n     */\r\n    function getInputRange(input) {\r\n        if (!input) {\r\n            return undefined;\r\n        }\r\n\r\n         var range = new Range();\r\n\r\n        range.start = input.selectionStart;\r\n        range.end = input.selectionEnd;\r\n\r\n        var min = Math.min(range.start, range.end);\r\n        var max = Math.max(range.start, range.end);\r\n\r\n        range.length = max - min;\r\n        range.text = datax.val(input).substring(min, max);\r\n\r\n        return range;\r\n\r\n    };\r\n\r\n     /**\r\n     * Sets the selected text range of (i.e., highlights text in) the given input.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @param {Number} startPos Zero-based index\r\n     * @param {Number} endPos Zero-based index\r\n     */\r\n    function setInputRange(input, startPos, endPos) {\r\n        startPos = _normalizePos(input, startPos);\r\n        endPos = _normalizePos(input, endPos);\r\n\r\n        // Mozilla, et al.\r\n        input.setSelectionRange(startPos, endPos);\r\n\r\n        return this;\r\n   };\r\n\r\n    /**\r\n     * Replaces the currently selected text with the given string.\r\n     * @param {HTMLInputElement|HTMLTextAreaElement} input input or textarea element\r\n     * @param {String} text New text that will replace the currently selected text.\r\n     * @see http://parentnode.org/javascript/working-with-the-cursor-position/\r\n     */\r\n    function replaceInputRange(input, text) {\r\n        var oldValue = datax.val(input);\r\n        var selection = getInputRange(input);\r\n\r\n        var newLength = +(selection.start + text.length + (oldValue.length - selection.end));\r\n        var maxLength = +datax.attr(input,'maxlength');\r\n\r\n        if(maxLength && newLength > maxLength) {\r\n            var delta = text.length - (newLength - maxLength);\r\n            text = text.substr(0, delta);\r\n        }\r\n\r\n        // Now that we know what the user selected, we can replace it\r\n        var startText = oldValue.substr(0, selection.start);\r\n        var endText = oldValue.substr(selection.end);\r\n\r\n        datax.val(input,startText + text + endText);\r\n\r\n        // Reset the selection\r\n        var startPos = selection.start;\r\n        var endPos = startPos + text.length;\r\n\r\n        setInputRange(input, selection.length ? startPos : endPos, endPos);\r\n        return this;\r\n    };\r\n\r\n    /**\r\n     * Select all text in the given element.\r\n     * @param {HTMLElement} elem Any block or inline element other than a form element.\r\n     */\r\n    function selectAll(elem) {\r\n        if (elem.select) {\r\n            elem.select();\r\n            return this;\r\n        }\r\n\r\n        var selection = window.getSelection();\r\n        var range = document.createRange();\r\n        range.selectNodeContents(elem);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n        return this;\r\n\r\n    }\r\n\r\n    function deselectAll() {\r\n        if (document.selection) {\r\n            document.selection.empty();\r\n        }\r\n        else if (window.getSelection) {\r\n            window.getSelection().removeAllRanges();\r\n        }\r\n        return this;\r\n    }\r\n\r\n\r\n    function caret(input,arg1) {\r\n        // getCaret()\r\n        if (arg1 === undefined) {\r\n            return getCaret(input);\r\n        }\r\n        // setCaret(position)\r\n        else if (typeof arg1 === 'number') {\r\n            setCaret(input, arg1);\r\n        }\r\n        // insertAtCaret(text)\r\n        else {\r\n            insertAtCaret(input, arg1);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    function range(input, arg1,arg2) {\r\n        // getRange() = { start: pos, end: pos }\r\n        if (arg1 === undefined) {\r\n            return getInputRange(input);\r\n        }\r\n        // setRange(startPos, endPos)\r\n        else if (typeof arg1 === 'number') {\r\n            var startPos = arg1;\r\n            var endPos = arg2;\r\n            setInputRange(input, startPos, endPos);\r\n        }\r\n        // replaceRange(text)\r\n        else {\r\n            var text = arg1;\r\n            replaceInputRange(input, text);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    function carets() {\r\n        return carets;\r\n    }\r\n\r\n    langx.mixin(carets,{\r\n        getCaret,\r\n        setCaret,\r\n        insertAtCaret,\r\n        getInputRange,\r\n        setInputRange,\r\n        replaceInputRange,\r\n        selectAll,\r\n        deselectAll,\r\n        caret,\r\n        range\r\n\r\n    });\r\n    return skylark.attach(\"domx.carets\", carets);\r\n});\ndefine('skylark-domx-carets/main',[\r\n    \"skylark-langx/langx\",\r\n    \"./carets\",\r\n    \"skylark-domx-velm\",\r\n    \"skylark-domx-query\",        \r\n    \"skylark-domx-eventer\"        \r\n],function(langx,carets,velm,$){\r\n\r\n    velm.delegate([\r\n        \"caret\",\r\n        \"insertAtCaret\",\r\n        \"range\",\r\n        \"selectAll\"\r\n    ], carets);\r\n\r\n    $.fn.caret = $.wraps.wrapper_value(carets.caret, carets, carets.caret);\r\n    $.fn.range = $.wraps.wrapper_value(carets.range, carets, carets.range);\r\n\r\n\r\n\treturn carets;\r\n});\ndefine('skylark-domx-carets', ['skylark-domx-carets/main'], function (main) { return main; });\n\n"]}